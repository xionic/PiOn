{"version":3,"sources":["Value.js","RestMessage.js","ItemMessage.js","SubscribeMessage.js","ItemEvent.js","WebSocketStatus.js","modules/PiOnModule.js","modules/ModuleBase.js","modules/ModuleToggleSwitch/ModuleToggleSwitch.js","modules/ModuleText/ModuleText.js","modules/ModuleTemperature/ModuleTemperature.js","modules/ModuleHumidity/ModuleHumidity.js","modules/ModuleSetpoint/ModuleSetpoint.js","modules/ModuleThermostat/ModuleThermostat.js","App.js","reportWebVitals.js","index.js"],"names":["Value","data","has_error","error_msg","timestamp","certainty","this","error_message","initialised","Math","floor","Date","now","CERTAIN","v","value","hasOwnProperty","RestMessage","type","context","sending_node","target_node","target_port","payload","id","REST_MESSAGE_COUNTER","JSON","stringify","obj","json","parse","from_obj","window","config","host","port","ItemMessage","item_name","action","console","error","SubscribeMessage","subscriptions","get_now","ItemEvent","ITEM_VALUE_CHANGED","WebSocketStatus","props","useState","text_state_str","setText_state_str","useEffect","websocket","interval","setInterval","text_state","readyState","Error","current_date","hours","getHours","mins","getMinutes","secs","getSeconds","padStart","clearInterval","PiOnModule","state","anchorEl","handleShowValuePopup","bind","handleHideValuePopup","event","log","setState","currentTarget","ts_string","undefined","val_timestamp","year","getFullYear","month","getMonth","day","getDate","valuePopup","Popover","onClose","open","anchorOrigin","vertical","horizontal","CustomTag","className","onClick","onValueChange","all_values","subscribeItem","Component","ModuleBase","checkValid","pionRender","ModuleToggleSwitch","handleChange","e","newVal","fromData","target","checked","curVal","Switch","disabled","onChange","ModuleText","text_prefix","text_postfix","updatePrefix","updatePostfix","ModuleTemperature","date","ts","getTime","cur_ts","num_days","day_str","time","slice","ModuleHumidity","ModuleSetpoint","handlePlus","handleMinus","increment","sendNewValue","num","parseFloat","TextField","size","classes","root","inputProps","step","Button","ModuleThermostat","initComplete","initStarted","setpoint","heater_switch","state_switch","temp_item","p1","p2","p3","p4","Promise","all","then","App","moduleValues","errorMsg","sitemap","handleModuleValueChange","sendValueUpdate","connectWebsocket","modules","modulesInited","modulesInitedProm","resolve","modulesInitedPromResolver","mountedProm","mountedPromResolver","errorMsgCounter","websocketConnectedProm","websocketConnectedPromResolver","configLoadProm","fetch","res","res_json","debug","location","hostname","websocket_url","websocket_path","api_url","sitemapLoadProm","res_sitemap","init_mod_vals","room","forEach","item","getUninitialised","prev","new_state","subscribe_items","sub_message","SUBSCRIBE","REQUEST_VALUES","rest_message","REQ","REST_CONTEXT_SUBSCRIBE","send","to_json","item_message","SET","withSendDefaults","REST_CONTEXT_ITEM","full_url","encodeURIComponent","retval","newState","close","websocket_prom","WebSocket","onopen","webSocket","onmessage","from_json","REST_CONTEXT_ITEMS","REST_CONTEXT_ERROR","errMsgId","setTimeout","removeErrorMsg","onerror","onclose","reconnectWebsocket","rooms","items","params","URLSearchParams","document","search","substring","auth","get","cur_value","push","errorElem","msgId","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.0469aabf.chunk.js","sourcesContent":["class Value {\r\n\t\r\n/*\r\n\tClass fields not supported by FF android(plus others) yet.\r\n\r\n\tdata;\r\n\thas_error;\r\n\terror_message;\r\n\ttimestamp;\r\n\tcertainty; // null for set requests\r\n\tinitialised; // false when no value is yet available\r\n*/\r\n\t\r\n\tconstructor(data, has_error, error_msg, timestamp, certainty){\r\n\t\tthis.data = data;\r\n\t\tthis.has_error = has_error;\r\n\t\tthis.error_message = error_msg;\r\n\t\tthis.timestamp = timestamp;\r\n\t\tthis.certainty = certainty;\r\n\t\tthis.initialised = true;\r\n\t}\r\n\r\n\t/*\r\n\t\tSimple function to generate a value object with defaults just from data\r\n\t*/\r\n\tstatic fromData(data){\r\n\t\treturn new Value(data, false, \"\", Math.floor(Date.now() / 1000), Value.CERTAIN);\r\n\t}\r\n\r\n\tstatic getUninitialised(){\r\n\t\tlet v = new Value(null,null,null,null,null);\r\n\t\tv.initialised = false;\r\n\t\treturn v;\r\n\t}\r\n\r\n\tstatic checkValid(value){\r\n\t\treturn (\r\n\t\t\tvalue.hasOwnProperty(\"data\")\r\n\t\t\t&& value.hasOwnProperty(\"has_error\")\r\n\t\t\t&& value.hasOwnProperty(\"error_message\")\r\n\t\t\t&& value.hasOwnProperty(\"timestamp\")\r\n\t\t\t&& value.hasOwnProperty(\"certainty\")\r\n\t\t\t&& value.hasOwnProperty(\"initialised\")\r\n\t\t)\r\n\t}\r\n\t\r\n\tstatic get CERTAIN() {\r\n\t\treturn \"CERTAIN\";\r\n\t}\r\n\tstatic get UNCERTAIN() {\r\n\t\treturn \"UNCERTAIN\";\r\n\t}\r\n\tstatic get UNKNOWN() {\r\n\t\treturn \"UNKNOWN\";\r\n\t}\r\n}\r\n\r\nexport default Value;","\r\nexport default class RestMessage {\r\n/*\r\n\tClass fields not supported by FF android(plus others) yet.\r\n\r\n\ttype; //req or resp (set requests are answered by resp's)\r\n\tcontext; //currently \"ITEM\" or \"EVENT\"\r\n\tsending_node;\r\n\ttarget_node; //probably only populated for req's\r\n\ttarget_port; // same\r\n\tpayload; // object passed as args to the get/set handler function as type appropriate\r\n*/\r\n\tstatic REST_MESSAGE_COUNTER;\r\n\tconstructor(type, context, sending_node, target_node, target_port, payload){\r\n\t\tthis.type = type;\r\n\t\tthis.context = context;\r\n\t\tthis.sending_node = sending_node;\r\n\t\tthis.target_node = target_node;\r\n\t\tthis.target_port = target_port;\r\n\t\tthis.payload = payload;\r\n\t\tthis.id = this.REST_MESSAGE_COUNTER++;\r\n\t}\r\n\r\n\t//\"types\"\r\n\tstatic get REQ() {\r\n\t\treturn \"REQ\";\r\n\t}\r\n\tstatic get RESP() {\r\n\t\treturn \"RESP\";\r\n\t}\r\n\r\n\t//contexts\r\n\tstatic get REST_CONTEXT_EVENT() {\r\n\t\treturn \"REST_CONTEXT_EVENT\";\r\n\t}\r\n\tstatic get REST_CONTEXT_ITEM() {\r\n\t\treturn \"REST_CONTEXT_ITEM\";\r\n\t}\r\n\tstatic get REST_CONTEXT_ITEMS() {\r\n\t\treturn \"REST_CONTEXT_ITEMS\";\r\n\t}\r\n\tstatic get REST_CONTEXT_SUBSCRIBE() {\r\n\t\treturn \"REST_CONTEXT_SUBSCRIBE\";\r\n\t}\r\n\tstatic get REST_CONTEXT_ERROR() {\r\n\t\treturn \"REST_CONTEXT_ERROR\";\r\n\t}\r\n\r\n\t\r\n\r\n\tstatic from_obj(obj){\r\n\t\treturn new RestMessage(\r\n\t\t\tobj.type,\r\n\t\t\tobj.context,\r\n\t\t\tobj.sending_node,\r\n\t\t\tobj.target_node,\r\n\t\t\tobj.target_port,\r\n\t\t\tobj.payload\r\n\t\t)\r\n\t}\r\n\r\n\tstatic from_json(json){\r\n\t\tlet obj = JSON.parse(json);\r\n\t\treturn RestMessage.from_obj(obj);\r\n\t}\r\n\r\n\tstatic withSendDefaults(type, context, payload){\r\n\t\treturn new RestMessage(type, context, \"client\", window.config.host, window.config.port, payload);\r\n\t}\r\n\t\r\n\tto_json(){\r\n\t\treturn JSON.stringify({\r\n\t\t\ttype: this.type,\r\n\t\t\tcontext: this.context,\r\n\t\t\tsending_node: this.sending_node,\r\n\t\t\ttarget_node: this.target_node,\r\n\t\t\ttarget_port: this.target_port,\r\n\t\t\tpayload: this.payload,\r\n\t\t\tid: this.id\r\n\t\t});\r\n\t}\r\n}","import Value from './Value.js';\r\n\r\nexport default class ItemMessage {\r\n/*\r\n\tClass fields not supported by FF android(plus others) yet.\r\n\r\n\titem_name;\r\n\tvalue;\r\n\taction;\r\n\taction_success;\r\n\terror_msg;\r\n*/\r\n\tconstructor(item_name, action, value){\r\n\t\tif(typeof item_name == 'undefined')\r\n\t\t\tconsole.error(\"Item name must be supplied\");\r\n\t\tif(typeof action == 'undefined')\r\n\t\t\tconsole.error(\"Action must be supplied\");\r\n\t\tif(typeof value == 'undefined')\r\n\t\t\tconsole.error(\"Value must be supplied\");\r\n\t\t\r\n\t\tthis.item_name = item_name;\r\n\t\tthis.value = value;\r\n\t\tthis.action = action;\r\n\t}\r\n\t\r\n\tstatic get GET(){\r\n\t\treturn \"GET\";\r\n\t}\r\n\tstatic get SET(){\r\n\t\treturn \"SET\";\r\n\t}\r\n\r\n\tstatic from_json(json){\r\n\t\tlet obj = JSON.parse();\r\n\t\treturn this.from_obj(obj);\r\n\t}\r\n\r\n\tstatic from_obj(obj){\r\n\t\tlet v = obj.value;\r\n\t\treturn new ItemMessage(obj.item_name, obj.action, new Value(v.data, v.has_error, v.error_message, v.timestamp, v.certainty));\r\n\t}\r\n\t\r\n\tto_json(){\r\n\t\treturn JSON.stringify({\r\n\t\t\titem_name: this.item_name,\r\n\t\t\tvalue: this.value,\r\n\t\t\taction: this.action\r\n\t\t});\r\n\t}\r\n\t\r\n}","export default class SubscribeMessage {\r\n/*\r\n\tClass fields not supported by FF android(plus others) yet.\r\n\r\n\tsubscriptions;\r\n*/\r\n    \r\n\tconstructor(subscriptions, type, get_now){ //get_now causes the current values to be sent after subscribing\r\n\t\tif(typeof subscriptions == 'undefined')\r\n\t\t\tconsole.error(\"Item name must be supplied\");\r\n\t\t\r\n\t\tthis.subscriptions = subscriptions;\r\n        this.type = type;\r\n        this.get_now = get_now\r\n\t}\r\n\t\r\n\tstatic get SUBSCRIBE(){\r\n\t\treturn \"SUBSCRIBE\";\r\n\t}\r\n\tstatic get REFRESH_ALL(){\r\n\t\treturn \"REFRESH_ALL\";\r\n\t}\r\n\tstatic get REQUEST_VALUES() {\r\n\t\treturn \"REQUEST_VALUES\";\r\n\t}\r\n\t\r\n\tto_json(){\r\n\t\treturn JSON.stringify({\r\n\t\t\tsubscriptions: this.subscriptions,\r\n\t\t\ttype: this.type,\r\n\t\t\tget_now: this.get_now\r\n\t\t});\r\n\t}\r\n\t\r\n}","export default class ItemEvent {\r\n    static ITEM_VALUE_CHANGED = \"ITEM_VALUE_CHANGED\";\r\n    static get events(){\r\n        return {\r\n            ITEM_VALUE_CHANGED: \"ITEM_VALUE_CHANGED\"\r\n        }\r\n    }\r\n    \r\n}","import React, {useEffect, useState}  from 'react';\r\n\r\nexport default function WebSocketStatus(props){\r\n\r\n    const [text_state_str, setText_state_str] = useState(\"\");\r\n\r\n    useEffect(() => {\r\n        if(props.websocket !== null){\r\n            const interval = setInterval(function () {\r\n                let text_state = \"\";\r\n                switch (props.websocket.readyState) {\r\n                    case 0:\r\n                        text_state = \"connecting\";\r\n                        break;\r\n                    case 1:\r\n                        text_state = \"connected\";\r\n                        break;\r\n                    case 2:\r\n                        text_state = \"closing\";\r\n                        break;\r\n                    case 3:\r\n                        text_state = \"closed\";\r\n                        break;\r\n                    default:\r\n                        throw Error(`Unknown websocket status: {props.websocket.readyState}`);\r\n                }\r\n                const current_date = new Date();\r\n                const hours = \"\" + current_date.getHours();\r\n                const mins = \"\" + current_date.getMinutes();\r\n                const secs = \"\" + current_date.getSeconds();\r\n                setText_state_str(\"Websocket is \" + text_state + \"@\" + hours.padStart(2, \"0\") + \":\" + mins.padStart(2, \"0\") + \":\" + secs.padStart(2, \"0\"));                \r\n            }, 500);\r\n\r\n            return () => {\r\n                clearInterval(interval);\r\n            }\r\n        } else {\r\n            setText_state_str(\"Websocket is initialising\");\r\n        }\r\n    });\r\n\r\n    \r\n    return <div id=\"websocketstatus\">{text_state_str}</div>\r\n}\r\n\r\n","import React, { Component } from 'react';\r\nimport Popover from '@material-ui/core/Popover';\r\n\r\nexport default class PiOnModule extends Component {\r\n\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = { anchorEl: null };\r\n\r\n        this.handleShowValuePopup = this.handleShowValuePopup.bind(this);\r\n        this.handleHideValuePopup = this.handleHideValuePopup.bind(this);\r\n    }\r\n\r\n    handleShowValuePopup(event) {\r\n        console.log(\"show popup!\");\r\n        this.setState({ anchorEl: event.currentTarget });\r\n    }\r\n\r\n    handleHideValuePopup(event) {\r\n        console.log(\"hide popup!\");\r\n        this.setState({ anchorEl: null });\r\n    }\r\n\r\n    render() {\r\n        let ts_string;\r\n        if (this.props.value.timestamp !== undefined) {\r\n            var val_timestamp = new Date(this.props.value.timestamp * 1000);\r\n            let year = \"\" + val_timestamp.getFullYear();\r\n            let month = (\"\" + (val_timestamp.getMonth() + 1)).padStart(2, '0');\r\n            let day = (\"\" + val_timestamp.getDate()).padStart(2, '0');\r\n            let hours = (\"\" + val_timestamp.getHours()).padStart(2, '0');\r\n            let mins = (\"\" + val_timestamp.getMinutes()).padStart(2, '0');\r\n            let secs = (\"\" + val_timestamp.getSeconds()).padStart(2, '0');\r\n            ts_string = hours + \":\" + mins + \":\" + secs + \" \" + year + \"/\" + month + \"/\" + day;\r\n        }\r\n        const valuePopup = <Popover\r\n            anchorEl={this.state.anchorEl}\r\n            onClose={this.handleHideValuePopup}\r\n            open={this.state.anchorEl !== null}\r\n            anchorOrigin={{\r\n                vertical: 'bottom',\r\n                horizontal: 'center',\r\n            }}\r\n        >\r\n            <div>data: {this.props.value.data}</div>\r\n            <div>has_error: {this.props.value.has_error ? \"true\" : \"false\"}</div>\r\n            <div>error_msg: {this.props.value.error_msg}</div>\r\n            <div>timestamp: {ts_string}</div>\r\n            <div>certainty: {this.props.value.certainty }</div>\r\n            <div>initialised: {this.props.value.initialised ? \"true\" : \"false\"}</div>\r\n        </Popover>;\r\n\r\n        const CustomTag = this.props.type;\r\n        return <span>\r\n            <span className=\"itemname\" onClick={this.handleShowValuePopup}>{this.props.item_name}</span>\r\n            {valuePopup}\r\n            <span className=\"itemvalue\">\r\n                <CustomTag item_name={this.props.item_name}\r\n                    value={this.props.value}\r\n                    onValueChange={this.props.onValueChange}\r\n                    all_values={this.props.all_values}\r\n                    subscribeItem={this.props.subscribeItem}\r\n                ></CustomTag>\r\n            </span>\r\n        </span >;\r\n    }\r\n}","\r\nimport React, { Component } from 'react';\r\nimport Value from '../Value.js';\r\n\r\n/* \r\n*    Abstract base class\r\n*/\r\nclass ModuleBase extends Component {\r\n\r\n    constructor(props){\r\n        super(props);\r\n        if (!props.hasOwnProperty(\"value\") || !Value.checkValid(props.value)){\r\n            throw Error(\"No or invalid value given to module\");\r\n        }\r\n    }\r\n\r\n    render() {\r\n        if (!this.props.value.initialised) {\r\n            return <span>No Value yet</span>;\r\n        } else {\r\n            return this.pionRender();\r\n        }\r\n    }\r\n}\r\n\r\nexport default ModuleBase;\r\n/*\r\n\r\n*/","\r\nimport React from 'react';\r\nimport ModuleBase from '../ModuleBase.js';\r\nimport Switch from '@material-ui/core/Switch';\r\nimport Value from '../../Value.js';\r\n\r\n\r\nclass ModuleToggleSwitch extends ModuleBase {\r\n\r\n    constructor(props) {\r\n        super(props);\r\n        this.handleChange = this.handleChange.bind(this);\r\n    }\r\n\r\n    handleChange(e) {\r\n        let newVal = Value.fromData(e.target.checked ? 1 : 0);\r\n        this.props.onValueChange(this.props.item_name, newVal);\r\n    }\r\n\r\n    pionRender() {      \r\n        const curVal = this.props.value.data === 1;\r\n        return <span><Switch disabled={this.props.hasOwnProperty(\"disabled\")?this.props.disabled:false} onChange={this.handleChange} checked={curVal}  className=\"react-switch\" /></span>\r\n    }\r\n}\r\n\r\nexport default ModuleToggleSwitch;\r\n/*\r\n\r\n*/","\r\nimport React from 'react';\r\nimport ModuleBase from '../ModuleBase.js';\r\n\r\n\r\nclass ModuleText extends ModuleBase {\r\n\r\n    constructor(props) {\r\n        super(props);\r\n        this.text_prefix = \"\";\r\n        this.text_postfix = \"\";\r\n    }\r\n\r\n    pionRender() {\r\n        this.updatePrefix();\r\n        this.updatePostfix();\r\n        return <span>{this.text_prefix}{this.props.value.data}{this.text_postfix}</span>\r\n    }\r\n\r\n    /*\r\n    * \"Abstract\" - Called during render - override to update subclass's prefix\r\n    */\r\n    updatePrefix() {\r\n\r\n    }\r\n\r\n    /*\r\n    * \"Abstract\" - Called during render - override to update subclass's postfix\r\n    */\r\n    updatePostfix() {\r\n\r\n    }\r\n}\r\n\r\nexport default ModuleText;\r\n/*\r\n\r\n*/","\r\nimport ModuleText from '../ModuleText/ModuleText.js';\r\n\r\n\r\nclass ModuleTemperature extends ModuleText {\r\n    \r\n    updatePostfix(){\r\n        let date = new Date(this.props.value.timestamp * 1000);\r\n\r\n        let ts = date.getTime();\r\n        let cur_ts = (new Date).getTime();\r\n        let num_days = Math.floor((cur_ts - ts) / 86400000);\r\n        let day_str = \"\"\r\n        if (num_days > 0){\r\n            day_str = \" -\" + num_days + \" days\";\r\n        }\r\n\r\n        let time = ('0' + date.getHours()).slice(-2) + \":\" + ('0' + date.getMinutes()).slice(-2) + \":\" + ('0' + date.getSeconds()).slice(-2);\r\n\r\n        this.text_postfix = \"°@\" + time + day_str;   \r\n    }\r\n}\r\n\r\nexport default ModuleTemperature;\r\n/*\r\n\r\n*/","\r\nimport ModuleText from '../ModuleText/ModuleText.js';\r\n\r\n\r\nclass ModuleHumidity extends ModuleText {\r\n\r\n  updatePostfix() {\r\n        let date = new Date(this.props.value.timestamp * 1000);\r\n\r\n        let ts = date.getTime();\r\n        let cur_ts = (new Date()).getTime();\r\n        let num_days = Math.floor((cur_ts - ts) / 86400000);\r\n        let day_str = \"\"\r\n        if (num_days > 0) {\r\n            day_str = \" -\" + num_days + \" days\";\r\n        }\r\n\r\n        let time = ('0' + date.getHours()).slice(-2) + \":\" + ('0' + date.getMinutes()).slice(-2) + \":\" + ('0' + date.getSeconds()).slice(-2);\r\n\r\n        this.text_postfix = \"%@\" + time + day_str;\r\n    }\r\n}\r\n\r\nexport default ModuleHumidity;\r\n/*\r\n\r\n*/","\r\nimport React from 'react';\r\nimport ModuleBase from '../ModuleBase.js';\r\nimport TextField from '@material-ui/core/TextField';\r\nimport Button from '@material-ui/core/Button';\r\nimport Value from '../../Value.js';\r\nimport './ModuleSetpoint.css';\r\n\r\n\r\nclass ModuleSetpoint extends ModuleBase {\r\n\r\n\r\n    constructor(props) {\r\n        super(props);\r\n        this.handleChange = this.handleChange.bind(this);\r\n        this.handlePlus = this.handlePlus.bind(this);\r\n        this.handleMinus = this.handleMinus.bind(this);\r\n\r\n        this.increment = 0.5;\r\n    }\r\n\r\n    handleChange(e) {\r\n        console.log(\"CHANGE\", e.target.value);\r\n        let newVal = Value.fromData(e.target.value);\r\n        this.sendNewValue(newVal);\r\n    }\r\n\r\n    handlePlus(e) {\r\n        let num = parseFloat(this.props.value.data) + this.increment;\r\n        let newVal = Value.fromData(num);\r\n        this.sendNewValue(newVal);\r\n    }\r\n\r\n    handleMinus(e) {\r\n        let num = parseFloat(this.props.value.data) - this.increment;\r\n        let newVal = Value.fromData(num);\r\n        this.sendNewValue(newVal);\r\n    }\r\n\r\n    sendNewValue(v) {\r\n        this.props.onValueChange(this.props.item_name, v);\r\n    }\r\n\r\n    pionRender() {\r\n        return <span>\r\n            <TextField onChange={this.handleChange} size=\"small\" type=\"number\" value={this.props.value.data} classes={{ root: \"pion-modulesetpointinput\" }} inputProps={{ step: this.increment, size: 2 }} />\r\n            <Button classes={{ root: \"pion-modulesetpointbutton\" }} onClick={this.handlePlus}>+</Button>\r\n            <Button classes={{ root: \"pion-modulesetpointbutton\" }} onClick={this.handleMinus}>-</Button>\r\n        </span >;\r\n    }\r\n}\r\n\r\nexport default ModuleSetpoint;\r\n/*\r\n\r\n*/","\r\nimport React from 'react';\r\nimport ModuleBase from '../ModuleBase.js';\r\nimport ModuleSetpoint from '../ModuleSetpoint/ModuleSetpoint.js';\r\nimport ModuleTemperature from '../ModuleTemperature/ModuleTemperature.js';\r\nimport ModuleToggleSwitch from '../ModuleToggleSwitch/ModuleToggleSwitch.js';\r\n\r\n\r\nclass ModuleThermostat extends ModuleBase {\r\n\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = { initComplete: false };\r\n        this.handleChange = this.handleChange.bind(this);\r\n        this.initStarted = false;\r\n    }\r\n\r\n    handleChange(item_name, value) {\r\n        this.props.onValueChange(item_name, value);\r\n    }\r\n\r\n    pionRender() {\r\n        if (!this.initStarted) {\r\n            this.initStarted = true;\r\n\r\n            this.setpoint = this.props.value.data.setpoint;\r\n            this.heater_switch = this.props.value.data.heater_switch;\r\n            this.state_switch = this.props.value.data.state_switch;\r\n            this.temp_item = this.props.value.data.temp_item;\r\n\r\n            const p1 = this.props.subscribeItem(this.setpoint);\r\n            const p2 = this.props.subscribeItem(this.heater_switch);\r\n            const p3 = this.props.subscribeItem(this.state_switch);\r\n            const p4 = this.props.subscribeItem(this.temp_item);\r\n\r\n            //wait for items to be registered so they have their values inited\r\n            Promise.all([p1, p2, p3, p4]).then(function () {\r\n\r\n                if (!this.props.all_values.hasOwnProperty(this.setpoint)) {\r\n                    throw Error(\"Thermostat setpoint item has no value.Is it the correct item?\");\r\n                }\r\n                if (!this.props.all_values.hasOwnProperty(this.heater_switch)) {\r\n                    throw Error(\"Thermostat heater_switch item has no value.Is it the correct item?\");\r\n                }\r\n                if (!this.props.all_values.hasOwnProperty(this.state_switch)) {\r\n                    throw Error(\"Thermostat state_switch item has no value.Is it the correct item?\");\r\n                }\r\n                if (!this.props.all_values.hasOwnProperty(this.temp_item)) {\r\n                    throw Error(\"Thermostat temp_item item has no value.Is it the correct item?\");\r\n                }\r\n                this.setState({ initComplete: true });\r\n\r\n\r\n            }.bind(this));\r\n        }\r\n\r\n        if (this.state.initComplete) {\r\n            return <span>\r\n                <ModuleToggleSwitch item_name={this.state_switch} value={this.props.all_values[this.state_switch]} all_values={this.props.all_values} onValueChange={this.handleChange}></ModuleToggleSwitch>\r\n\r\n                <ModuleSetpoint item_name={this.setpoint} value={this.props.all_values[this.setpoint]} all_values={this.props.all_values} onValueChange={this.handleChange}></ModuleSetpoint>\r\n\r\n                <ModuleTemperature item_name={this.temp_item} value={this.props.all_values[this.temp_item]} all_values={this.props.all_values}></ModuleTemperature>\r\n\r\n                <ModuleToggleSwitch item_name={this.heater_switch} value={this.props.all_values[this.heater_switch]} all_values={this.props.all_values} disabled={true}></ModuleToggleSwitch>\r\n            </span>\r\n        } else {\r\n            return <span>Initialising...</span>\r\n        }\r\n    };\r\n}\r\n\r\nexport default ModuleThermostat;\r\n/*\r\n\r\n*/","\nimport React, { Component } from 'react';\nimport Value from './Value.js';\nimport RestMessage from './RestMessage.js';\nimport ItemMessage from './ItemMessage.js';\nimport SubscribeMessage from './SubscribeMessage.js';\nimport ItemEvent from './ItemEvent.js';\n\nimport WebSocketStatus from './WebSocketStatus.js';\nimport PiOnModule from './modules/PiOnModule.js';\n\nimport ModuleToggleSwitch from './modules/ModuleToggleSwitch/ModuleToggleSwitch.js';\nimport ModuleText from './modules/ModuleText/ModuleText.js';\nimport ModuleTemperature from './modules/ModuleTemperature/ModuleTemperature.js';\nimport ModuleHumidity from './modules/ModuleHumidity/ModuleHumidity.js';\nimport ModuleThermostat from './modules/ModuleThermostat/ModuleThermostat.js';\nimport ModuleSetpoint from './modules/ModuleSetpoint/ModuleSetpoint.js';\n\nimport './App.css';\n\nwindow.config = null;\n\nclass App extends Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      moduleValues: {},\n      errorMsg: {},\n      sitemap: {}\n    };\n\n    //bind this to methods\n    this.handleModuleValueChange = this.handleModuleValueChange.bind(this);\n    this.sendValueUpdate = this.sendValueUpdate.bind(this);\n    this.connectWebsocket = this.connectWebsocket.bind(this);\n    this.subscribeItem = this.subscribeItem.bind(this);\n\n    //defined map of PiOn modules to local component names\n    this.modules = {\n      \"switch\": ModuleToggleSwitch,\n      \"text\": ModuleText,\n      \"temperature\": ModuleTemperature,\n      \"humidity\": ModuleHumidity,\n      \"thermostat\": ModuleThermostat,\n      \"setpoint\": ModuleSetpoint\n    }\n\n    //declare WS\n    this.websocket = null;\n\n    this.modulesInited = false;\n    this.modulesInitedProm = new Promise(function (resolve) {\n      this.modulesInitedPromResolver = resolve;\n    }.bind(this));\n\n    //has the App mmounted yet?\n    this.mountedProm = new Promise((resolve) => {\n      this.mountedPromResolver = resolve;\n    });\n\n    this.errorMsgCounter = 0;\n\n    //has websocket connected yet?\n    this.websocketConnectedProm = new Promise((resolve) => {\n      this.websocketConnectedPromResolver = resolve;\n    });\n\n    //fetch config\n    this.configLoadProm = new Promise((resolve) => {\n      fetch(\"webconfig.json\")\n        .then(res => res.json())\n        .then(res_json => { //config loaded\n          window.config = res_json;\n          console.debug(\"config.json loaded\", window.config);\n          if (window.config.host === null) {\n            window.config.host = window.location.hostname; //default to current hostname - for config simplicity\n          }\n          window.config.websocket_url = \"ws://\" + window.config.host + \":\" + window.config.port + window.config.websocket_path;\n          window.config.api_url = \"http://\" + window.config.host + \":\" + window.config.port + \"/api/\";\n          resolve();\n        });\n    });\n\n    this.sitemapLoadProm = new Promise((resolve) => {\n      fetch(\"sitemap.json\")\n        .then(res => res.json())\n        .then(res_json => { //sitemap loaded       \n          const res_sitemap = res_json;\n          console.debug(\"sitemap.json loaded\", res_sitemap);\n          //init module values\n          let init_mod_vals = {};\n          for (const room in res_sitemap) {\n            res_sitemap[room].forEach((item) => {\n              init_mod_vals[item.item_name] = Value.getUninitialised();\n            });\n          }\n          this.mountedProm.then(function () {\n            this.setState({ moduleValues: init_mod_vals, sitemap: res_sitemap }, () => {\n              this.modulesInited = true;\n              this.modulesInitedPromResolver(true);\n              resolve();\n            });\n          }.bind(this));\n        });\n    });\n\n\n  }\n\n  componentDidMount() {\n    this.mountedPromResolver();\n    this.configLoadProm.then(() => {\n      this.sitemapLoadProm.then(() => {\n        this.connectWebsocket();\n      });\n    });\n  }\n\n  /**\n   * \n   * register an item to be subscribed to over the websocket for value updates\n   */\n  subscribeItem(item_name) {\n    //don't subscribe if we already have\n    if (this.state.moduleValues.hasOwnProperty(item_name)) {\n      return Promise.resolve(true);\n    }\n    return new Promise(function (item_name, resolve) {\n      this.mountedProm.then(function (item_name, resolve) {\n        this.websocketConnectedProm.then(function (item_name, resolve) {\n\n          //add item to list\n          this.setState((prev) => {\n            const new_state = { ...prev };\n            new_state.moduleValues[item_name] = Value.getUninitialised();\n            return new_state;\n          });\n          resolve(true);\n\n          //subscribe to items\n          let subscribe_items = {};\n          subscribe_items[item_name] = [ItemEvent.ITEM_VALUE_CHANGED];\n\n          //build subscribe message with all items and events we're subing to\n          let sub_message = new SubscribeMessage(subscribe_items, SubscribeMessage.SUBSCRIBE, SubscribeMessage.REQUEST_VALUES);\n\n          //build the rest message to be sent over the WS\n          let rest_message = new RestMessage(RestMessage.REQ, RestMessage.REST_CONTEXT_SUBSCRIBE, 'client', window.config.host, window.config.port, sub_message);\n\n          console.log(\"WS: Sending SUBSCRIBE RestMessage: \", rest_message);\n          this.websocket.send(rest_message.to_json());\n        }.bind(this, item_name, resolve));\n      }.bind(this, item_name, resolve));\n    }.bind(this, item_name));\n  }\n\n  handleModuleValueChange(item_name, value) {\n    if (Value.checkValid(value)) {\n      throw Error(\"value passed is not an instance of Value\");\n    }\n    this.sendValueUpdate(item_name, value);\n\n    /*setmoduleValues((prev_state) => {\n      prev_state.[item_name] = value;\n      return prev_state;\n    });*/\n  }; //end handleModuleValueChange\n\n  sendValueUpdate(item_name, value) {\n    let item_message = new ItemMessage(item_name, ItemMessage.SET, value);\n    let rest_message = RestMessage.withSendDefaults(RestMessage.REQ, RestMessage.REST_CONTEXT_ITEM, item_message);\n    // console.log(rest_message);\n    console.debug(`Sending update to server for item '${item_name}' and item_message:`, item_message);\n    let full_url = window.config.api_url + \"?data=\" + encodeURIComponent(rest_message.to_json());\n    console.debug(`Full URL: ${full_url}`);\n    fetch(full_url)\n      .then((retval) => {\n        console.debug(\"SET request result:\", retval);\n      });\n\n  } //end sendValueUpdate\n\n  reconnectWebsocket() {\n    //reset item values to uninitialised\n    this.modulesInited = false;\n    this.modulesInitedProm = new Promise(function (resolve) {\n      this.modulesInitedPromResolver = resolve;\n    }.bind(this));\n    this.setState(function (prev) {\n      let newState = { ...prev };\n      for (const item in newState.moduleValues) {\n        newState.moduleValues[item] = Value.getUninitialised();\n      }\n    }, function () { //done resetting module values\n      this.modulesInited = true;\n      this.modulesInitedPromResolver();\n      this.websocket.close(); //make sure\n      this.websocket = null;\n      this.connectWebsocket();\n    }.bind(this));\n\n  }\n\n  removeErrorMsg(id) {\n    this.setState((prev) => {\n      let newState = { ...prev };\n      delete newState.errorMsg[id];\n      return newState;\n    });\n  }\n\n  //connect websocket\n  connectWebsocket() {\n    if (this.websocket !== null) {\n      console.error(\"Websocket already exists\");\n      return;\n    }\n\n    //ensure modules are inited before we subscribe, since we need the complete list\n    this.modulesInitedProm.then(function () {\n\n      //after config and sitemap are loaded, setup websocket\n      this.websocket_prom = new Promise(function (resolve) {\n        console.debug(\"Websocket connecting...\");\n        this.websocket = new WebSocket(window.config.websocket_url);\n        this.websocket.onopen = function () {\n          console.log(\"Websocket connection established to:\", window.config.websocket_url);\n          this.setState({ webSocket: this.websocket }, () => {\n            resolve(this.websocket);\n            this.websocketConnectedPromResolver(this.websocket);\n          })\n\n          //subscribe to items\n          let subscribe_items = {};\n\n          for (const item_name in this.state.moduleValues)  {\n            subscribe_items[item_name] = [ItemEvent.ITEM_VALUE_CHANGED];\n          };\n\n          //build subscribe message with all items and events we're subing to\n          let sub_message = new SubscribeMessage(subscribe_items, SubscribeMessage.SUBSCRIBE, SubscribeMessage.REQUEST_VALUES);\n\n          //build the rest message to be sent over the WS\n          let rest_message = new RestMessage(RestMessage.REQ, RestMessage.REST_CONTEXT_SUBSCRIBE, 'client', window.config.host, window.config.port, sub_message);\n\n          console.log(\"WS: Sending SUBSCRIBE RestMessage: \", rest_message);\n          this.websocket.send(rest_message.to_json());\n\n        }.bind(this) // end onopen\n\n        // Listen for messages\n        this.websocket.onmessage = function (event) {\n          let rest_message = RestMessage.from_json(event.data);\n          console.log('Message from WebSocket ', rest_message);\n\n          switch (rest_message.context) {\n            case RestMessage.REST_CONTEXT_ITEM:\n              rest_message.payload = [rest_message.payload];\n            // eslint-disable-next-line no-fallthrough\n            case RestMessage.REST_CONTEXT_ITEMS:\n              rest_message.payload.forEach(function (item) {\n                let item_message = ItemMessage.from_obj(item);\n                console.debug(\"WS: Received value for item: \", item_message.item_name, \" with data: \", item_message.value.data);\n                this.setState((prev) => {\n                  const new_state = { ...prev };\n                  new_state.moduleValues[item_message.item_name] = item_message.value;\n                  return new_state;\n                });\n              }.bind(this));\n\n              break;\n\n            case RestMessage.REST_CONTEXT_ERROR:\n              console.log(\"WS: Received ERROR message: \" + rest_message.payload);\n              const errMsgId = this.errorMsgCounter++;\n              this.setState(function (prev) {\n                let new_state = { ...prev };\n                new_state.errorMsg[errMsgId] = rest_message.payload;\n                setTimeout(function () {\n                  this.removeErrorMsg(errMsgId);\n                }.bind(this), 5000);\n                return new_state;\n              }.bind(this));\n              break;\n\n            default:\n              console.log(\"WS: Received unknown rest message context: \" + rest_message.context);\n\n            //alert(\"ERROR: \" + rest_message.payload);\n          }\n        }.bind(this) //end onmessage\n\n        this.websocket.onerror = function () {\n          console.debug(\"Websocket error\");\n          //don't reconnect here as onclosed will also be called        \n        }.bind(this);\n\n        this.websocket.onclose = function () {\n          console.debug(\"Websocket closed - reconnecting\");\n          //back off on error to avoid spam\n          setTimeout(function () {\n            this.reconnectWebsocket();\n          }.bind(this),\n            1000);\n\n        }.bind(this);\n\n      }.bind(this));\n\n    }.bind(this)); //end modulesInitedProm\n  }\n\n  render() {\n    //render\n    if (window.config !== null && this.state.sitemap !== null && this.modulesInited !== false) {\n      let rooms = [];\n      for (const room in this.state.sitemap) {\n        let items = [];\n        this.state.sitemap[room].forEach((item) => {\n\n          let params = new URLSearchParams(document.location.search.substring(1));\n          if (item.auth && params.get(\"auth\") == null) return; //dev hack\n\n          const CustomTag = this.modules[item.type];\n          const cur_value = this.state.moduleValues[item.item_name];\n\n          items.push(\n            <li className=\"item\" key={item.item_name}>\n              <PiOnModule\n                type={CustomTag}\n                item_name={item.item_name}\n                value={cur_value}\n                onValueChange={this.handleModuleValueChange}\n                all_values={this.state.moduleValues}\n                subscribeItem={this.subscribeItem}\n              ></PiOnModule>\n            </li>\n          );\n        });\n        rooms.push(\n          <li className=\"roomrow\" key={room}>\n            <h3 className=\"roomname\">{room}</h3\n            ><ul>{items}</ul>\n          </li>)\n\n      }\n\n      let errorElem = [];\n      if (this.state.errorMsg !== \"\") {\n        for (const msgId in this.state.errorMsg) {\n          errorElem.push(<div key={msgId} className=\"rest_errorMsg\">{this.state.errorMsg[msgId]}</div>);\n        }\n      }\n\n      return <div id=\"outercont\">\n        {errorElem}\n        <div>\n          <WebSocketStatus websocket={this.state.webSocket}></WebSocketStatus>\n        </div>\n        <div id=\"tablecont\">\n          <ul>{rooms}</ul>\n        </div>\n      </div>;\n\n\n    } else { //sitemap not loaded yet\n      return <span>Loading config and sitemap...</span>;\n    }\n  }\n}\nexport default App;\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\n\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}